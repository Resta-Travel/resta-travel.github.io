<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Resta Travel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; }
        .glass { background: white; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; }
        .toast.show { visibility: visible; -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        
        /* Login Screen Style */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            display: flex; justify-content: center; align-items: center; z-index: 9999;
        }
        .hidden-app { display: none; }
    </style>
</head>
<body class="text-slate-800">

    <div id="login-screen">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md text-center transform transition-all scale-100 hover:scale-105">
            <div class="mb-6">
                <i class="fas fa-lock text-5xl text-blue-600 mb-4"></i>
                <h2 class="text-2xl font-bold text-slate-800">Admin Login</h2>
                <p class="text-slate-500 text-sm">Masukkan sandi untuk akses data Resta Travel</p>
            </div>
            
            <form onsubmit="checkLogin(event)" class="space-y-4">
                <div class="relative">
                    <i class="fas fa-key absolute left-4 top-3.5 text-slate-400"></i>
                    <input type="password" id="passwordInput" placeholder="Masukkan Sandi..." class="w-full pl-10 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition shadow-lg">
                    MASUK DASHBOARD
                </button>
            </form>
            <p id="error-msg" class="text-red-500 text-xs mt-3 hidden font-bold">‚ö†Ô∏è Sandi Salah! Akses Ditolak.</p>
            <p class="text-xs text-slate-400 mt-6">Resta Travel Security System v1.0</p>
        </div>
    </div>

    <div id="main-app" class="hidden-app">
        
        <nav class="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fas fa-user-tie text-yellow-400 text-2xl"></i>
                    <div>
                        <h1 class="text-lg font-bold leading-tight">Admin Panel <span class="text-yellow-400">Resta Travel</span></h1>
                        <p class="text-[10px] text-slate-400">Manajemen Data & Sopir</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="logout()" class="text-xs bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded transition border border-slate-600">
                        <i class="fas fa-sign-out-alt mr-1"></i> Keluar
                    </button>
                    <button onclick="clearAllData()" class="text-xs bg-red-600/20 text-red-400 border border-red-600/50 hover:bg-red-600 hover:text-white px-3 py-1.5 rounded transition">
                        <i class="fas fa-trash-alt mr-1"></i> Reset
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 space-y-6">
                <div class="glass p-5 rounded-xl border-l-4 border-green-500 bg-white">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="font-bold text-sm flex items-center gap-2 text-slate-700">
                            <i class="fab fa-whatsapp text-green-500 text-lg"></i> Import Pesan WA
                        </h2>
                        <button onclick="document.getElementById('waPasteArea').value=''" class="text-[10px] text-slate-400 hover:text-red-500">Clear</button>
                    </div>
                    <textarea id="waPasteArea" rows="3" class="w-full p-3 text-xs border rounded-lg bg-slate-50 focus:ring-1 focus:ring-green-500 outline-none resize-none" placeholder="Tempel format pemesanan lengkap disini..."></textarea>
                    <button onclick="parseWhatsApp()" class="w-full mt-2 bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 py-2 rounded-lg font-bold text-xs transition">
                        <i class="fas fa-magic mr-1"></i> Ekstrak Data ke Form
                    </button>
                </div>

                <div class="glass p-5 rounded-xl border-l-4 border-blue-600 bg-white">
                    <h2 class="font-bold text-sm mb-4 text-slate-700 border-b pb-2">Formulir Data Penumpang</h2>
                    <form id="bookingForm" onsubmit="saveBooking(event)" class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase">Tanggal</label>
                                <input type="date" id="date" required class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase">Jam</label>
                                <input type="text" id="time" placeholder="11:00" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none">
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase">Nama Penumpang</label>
                            <input type="text" id="name" required class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none font-bold">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase">No HP</label>
                                <input type="text" id="phone" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase">Kursi</label>
                                <input type="text" id="seat" placeholder="Contoh: 1, 2" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none">
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase">Rute</label>
                            <input type="text" id="route" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase">Jemput</label>
                            <textarea id="pickup" rows="2" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none"></textarea>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase">Tujuan (Antar)</label>
                            <textarea id="dropoff" rows="2" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none"></textarea>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase">Total Harga</label>
                            <input type="text" id="price" class="w-full p-2 text-sm border rounded bg-slate-50 focus:border-blue-500 outline-none">
                        </div>

                        <button type="submit" class="w-full mt-2 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold shadow-lg shadow-blue-500/30 transition flex justify-center items-center gap-2">
                            <i class="fas fa-save"></i> SIMPAN & GENERATE
                        </button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-800">Manifest Penumpang</h2>
                    <div class="text-xs text-slate-500">
                        <i class="fas fa-sort-amount-down mr-1"></i> Urut Tanggal
                    </div>
                </div>

                <div id="bookingList" class="space-y-6 pb-20">
                    </div>
            </div>
        </div>

        <div id="toast" class="toast">Data Berhasil Disalin ke Clipboard!</div>
    </div>

    <script>
        // ================= SECURITY LOGIC =================
        
        // GANTI PASSWORD DI SINI (Ganti '12345' dengan password pilihan Anda)
        const ADMIN_PASS = "123574"; 

        function checkLogin(e) {
            e.preventDefault();
            const input = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('error-msg');
            const loginScreen = document.getElementById('login-screen');
            const mainApp = document.getElementById('main-app');

            if (input === ADMIN_PASS) {
                // Password Benar
                errorMsg.classList.add('hidden');
                loginScreen.style.opacity = '0';
                setTimeout(() => {
                    loginScreen.style.display = 'none';
                    mainApp.classList.remove('hidden-app');
                    loadBookings(); // Load data hanya jika sudah login
                }, 500);
            } else {
                // Password Salah
                errorMsg.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function logout() {
            location.reload(); // Refresh halaman untuk mengunci kembali
        }

        // ================= APP LOGIC (Sama seperti sebelumnya) =================

        function parseWhatsApp() {
            const text = document.getElementById('waPasteArea').value;
            if(!text) return alert("Tempelkan teks WhatsApp dulu!");

            const namaMatch = text.match(/Nama:\*?\s*(.*)/i);
            const hpMatch = text.match(/No HP:\*?\s*([\d\-\+\s]+)/i);
            const ruteMatch = text.match(/Rute:\*?\s*(.*)/i);
            const jadwalMatch = text.match(/Jadwal:\*?\s*([\d-]+)/); 
            const jamMatch = text.match(/\|\s*Jam\s*(.*)/i);
            const kursiMatch = text.match(/Kursi:\*?\s*No\.?\s*(.*)/i);
            const hargaMatch = text.match(/Total:\*?\s*(.*)/i);
            const jemputMatch = text.match(/Jemput:\*?\s*(.*)/i);
            const tujuanMatch = text.match(/Tujuan:\*?\s*(.*)/i);

            if(namaMatch) document.getElementById('name').value = namaMatch[1].trim();
            if(hpMatch) document.getElementById('phone').value = hpMatch[1].trim();
            if(ruteMatch) document.getElementById('route').value = ruteMatch[1].trim();
            if(jadwalMatch) document.getElementById('date').value = jadwalMatch[1].trim();
            if(jamMatch) document.getElementById('time').value = jamMatch[1].trim();
            if(kursiMatch) document.getElementById('seat').value = kursiMatch[1].replace(/\(.*\)/, '').trim(); 
            if(hargaMatch) document.getElementById('price').value = hargaMatch[1].trim();
            if(jemputMatch) document.getElementById('pickup').value = jemputMatch[1].trim();
            if(tujuanMatch) document.getElementById('dropoff').value = tujuanMatch[1].trim();

            showToast("Data terekstrak! Cek form sebelum simpan.");
        }

        function generateDriverText(data) {
            return `*DATA PENUMPANG RESTA TRAVEL*\n` +
                   `----------------------------------\n` +
                   `üë§ Nama: ${data.name}\n` +
                   `üìû HP: ${data.phone}\n` +
                   `üìÖ Tgl: ${data.date}\n` +
                   `‚è∞ Jam: ${data.time}\n` +
                   `üí∫ Kursi: ${data.seat}\n` +
                   `üìç Rute: ${data.route}\n` +
                   `----------------------------------\n` +
                   `üè† Jemput: ${data.pickup}\n` +
                   `üè¢ Tujuan: ${data.dropoff}\n` +
                   `üí∞ Tagihan: ${data.price}\n` +
                   `----------------------------------`;
        }

        function saveBooking(e) {
            e.preventDefault();

            const rawData = {
                id: Date.now(),
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                route: document.getElementById('route').value,
                seat: document.getElementById('seat').value,
                price: document.getElementById('price').value,
                pickup: document.getElementById('pickup').value,
                dropoff: document.getElementById('dropoff').value
            };

            rawData.driverText = generateDriverText(rawData);

            let bookings = JSON.parse(localStorage.getItem('restaBookings')) || [];
            bookings.push(rawData);
            localStorage.setItem('restaBookings', JSON.stringify(bookings));

            document.getElementById('bookingForm').reset();
            document.getElementById('waPasteArea').value = '';
            loadBookings();
            showToast("Booking Tersimpan!");
        }

        function loadBookings() {
            let bookings = JSON.parse(localStorage.getItem('restaBookings')) || [];
            const container = document.getElementById('bookingList');
            container.innerHTML = '';

            if (bookings.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-slate-400 border-2 border-dashed border-slate-300 rounded-xl"><p>Belum ada data.</p></div>`;
                return;
            }

            bookings.sort((a, b) => new Date(a.date) - new Date(b.date));
            const grouped = {};
            bookings.forEach(b => {
                if (!grouped[b.date]) grouped[b.date] = [];
                grouped[b.date].push(b);
            });

            for (const [date, items] of Object.entries(grouped)) {
                const dateHeader = new Date(date).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'short', year: 'numeric' });
                
                const dailyManifest = items.map((item, index) => 
                    `[PENUMPANG KE-${index+1}]\n` + item.driverText
                ).join('\n\n========================\n\n');

                let groupHTML = `
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
                        <div class="bg-slate-100 px-4 py-3 border-b border-slate-200 flex flex-wrap justify-between items-center gap-2">
                            <h3 class="font-bold text-slate-800 text-sm md:text-base"><i class="far fa-calendar-alt text-blue-600 mr-2"></i> ${dateHeader}</h3>
                            <div class="flex items-center gap-2">
                                <span class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full">${items.length} Org</span>
                                <button onclick="copyText(\`${encodeURIComponent(dailyManifest)}\`)" class="bg-slate-800 hover:bg-slate-700 text-white text-xs px-3 py-1.5 rounded flex items-center gap-1 transition">
                                    <i class="fas fa-copy"></i> Salin Manifest Harian
                                </button>
                            </div>
                        </div>
                        <div class="divide-y divide-slate-100">
                `;

                items.forEach(item => {
                    groupHTML += `
                        <div class="p-4 hover:bg-slate-50 transition relative group">
                            <div class="flex flex-col md:flex-row justify-between gap-4">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-bold text-slate-800">${item.name}</span>
                                        <a href="https://wa.me/${item.phone.replace(/[^0-9]/g, '')}" target="_blank" class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded border border-green-200 hover:bg-green-200">
                                            <i class="fab fa-whatsapp"></i> ${item.phone}
                                        </a>
                                    </div>
                                    <div class="text-xs text-slate-500 grid grid-cols-1 md:grid-cols-2 gap-y-1 gap-x-4 mb-2">
                                        <span><i class="far fa-clock text-blue-500 w-4"></i> ${item.time}</span>
                                        <span><i class="fas fa-route text-green-500 w-4"></i> ${item.route}</span>
                                        <span><i class="fas fa-chair text-orange-500 w-4"></i> Kursi No. ${item.seat}</span>
                                        <span class="font-bold text-slate-700"><i class="fas fa-tag text-slate-400 w-4"></i> ${item.price}</span>
                                    </div>
                                    <div class="bg-slate-50 p-2 rounded border border-slate-100 text-xs text-slate-600">
                                        <p class="mb-1"><strong class="text-slate-400">Jemput:</strong> ${item.pickup}</p>
                                        <p><strong class="text-slate-400">Antar:</strong> ${item.dropoff}</p>
                                    </div>
                                </div>
                                
                                <div class="flex md:flex-col gap-2 justify-end items-end min-w-[140px]">
                                    <button onclick="copyText(\`${encodeURIComponent(item.driverText)}\`)" class="w-full text-xs bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 px-3 py-2 rounded flex items-center justify-center gap-2 shadow-sm">
                                        <i class="far fa-copy"></i> Salin Data
                                    </button>
                                    <button onclick="deleteBooking(${item.id})" class="w-full text-xs bg-white border border-red-200 hover:bg-red-50 text-red-500 px-3 py-2 rounded flex items-center justify-center gap-2">
                                        <i class="fas fa-trash"></i> Hapus
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                groupHTML += `</div></div>`;
                container.innerHTML += groupHTML;
            }
        }

        function copyText(encodedText) {
            const text = decodeURIComponent(encodedText);
            navigator.clipboard.writeText(text).then(() => {
                showToast("Data Berhasil Disalin!");
            }).catch(err => {
                console.error('Gagal menyalin: ', err);
                alert("Gagal menyalin. Izin browser diperlukan.");
            });
        }

        function deleteBooking(id) {
            if(confirm("Hapus data ini?")) {
                let bookings = JSON.parse(localStorage.getItem('restaBookings')) || [];
                bookings = bookings.filter(b => b.id !== id);
                localStorage.setItem('restaBookings', JSON.stringify(bookings));
                loadBookings();
            }
        }

        function clearAllData() {
            if(confirm("Hapus SEMUA data?")) {
                localStorage.removeItem('restaBookings');
                loadBookings();
            }
        }

        function showToast(message) {
            var x = document.getElementById("toast");
            x.innerText = message;
            x.className = "toast show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }
    </script>
</body>
</html>